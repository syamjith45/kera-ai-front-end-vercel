<div class="p-6 max-w-lg mx-auto bg-white rounded-xl shadow-md space-y-4">
  <h2 class="text-2xl font-bold text-gray-900">Walk-in Spot Booking</h2>
  
  <!-- Messages -->
  <div *ngIf="errorMessage()" class="p-3 bg-red-100 text-red-700 rounded-lg">
    {{ errorMessage() }}
  </div>
  <div *ngIf="successMessage()" class="p-3 bg-green-100 text-green-700 rounded-lg text-center">
    <p class="font-bold">{{ successMessage() }}</p>
    <div class="mt-2 flex justify-center" *ngIf="lastBookingQrData()">
        <img [src]="'https://api.qrserver.com/v1/create-qr-code/?size=160x160&data=' + lastBookingQrData()" alt="QR Code" class="rounded-lg shadow-sm">
    </div>
  </div>

  <form (submit)="submitBooking(); $event.preventDefault()" class="space-y-4">
    
    <!-- Parking Lot Selection -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Parking Lot</label>
      <select 
        [ngModel]="selectedLotId()" 
        (ngModelChange)="selectedLotId.set($event); onLotChange()"
        name="lotId" 
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
        <option *ngFor="let lot of parkingLots()" [value]="lot.id">
          {{ lot.name }} - {{ lot.address }}
        </option>
      </select>
    </div>

    <!-- Slot Selection -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Select Slot</label>
      <div *ngIf="availableSlots().length === 0" class="text-red-500 text-sm mt-1">
        No slots available.
      </div>
      <select 
        *ngIf="availableSlots().length > 0"
        [ngModel]="selectedSlotId()" 
        (ngModelChange)="selectedSlotId.set($event)"
        name="slotId" 
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
        <option *ngFor="let slot of availableSlots()" [value]="slot.id">
          Slot {{ slot.id }}
        </option>
      </select>
    </div>

    <!-- Duration -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Duration (Hours)</label>
      <input 
        type="number" 
        [ngModel]="duration()" 
        (ngModelChange)="duration.set($event); calculateCost()"
        name="duration" 
        min="1" 
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border">
      <p class="mt-1 text-sm text-gray-500">Total Cost: â‚¹{{ totalCost() }}</p>
    </div>

    <!-- Guest Details -->
    <div>
      <label class="block text-sm font-medium text-gray-700">Guest Name *</label>
      <input 
        type="text" 
        [ngModel]="walkInName()" 
        (ngModelChange)="walkInName.set($event)"
        name="walkInName" 
        required
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"
        placeholder="Enter name">
    </div>

    <div>
      <label class="block text-sm font-medium text-gray-700">Phone Number (Optional)</label>
      <input 
        type="tel" 
        [ngModel]="walkInPhone()" 
        (ngModelChange)="walkInPhone.set($event)"
        name="walkInPhone" 
        class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500 sm:text-sm p-2 border"
        placeholder="Enter phone">
    </div>

    <!-- Vehicle Details -->
    <div>
        <label class="block text-sm font-medium text-gray-700">Vehicle Number (Optional)</label>
        <div class="mt-1 flex rounded-md shadow-sm">
          <input 
            type="text" 
            [ngModel]="vehicleNumber()" 
            (ngModelChange)="vehicleNumber.set($event)"
            name="vehicleNumber" 
            class="focus:ring-indigo-500 focus:border-indigo-500 flex-1 block w-full rounded-md sm:text-sm border-gray-300 border p-2 uppercase" 
            placeholder="KL-01-AB-1234">
        </div>
        <p class="mt-1 text-xs text-gray-500">Enter vehicle plate number for record.</p>
    </div>

    <!-- Submit Button -->
    <button 
      type="submit" 
      [disabled]="isLoading() || availableSlots().length === 0"
      class="w-full flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 disabled:bg-gray-400">
      <span *ngIf="isLoading()">Processing...</span>
      <span *ngIf="!isLoading()">Confirm Booking</span>
    </button>
  </form>
</div>
